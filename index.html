<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DashControl Enterprise FINAL</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { margin:0; font-family:'Poppins',sans-serif; background:#0d0d0d; color:white; }
    header { background:linear-gradient(90deg,#8e44ad,#b8860b); padding:15px; font-size:22px; font-weight:700; text-align:center; }
    nav { display:flex; justify-content:center; flex-wrap:wrap; background:#1e1e1e; }
    nav button { background:#8e44ad; border:none; margin:5px; padding:10px 15px; border-radius:8px; color:white; font-weight:bold; cursor:pointer; }
    nav button:hover { background:#b8860b; }
    section { display:none; padding:20px; max-width:1000px; margin:auto; }
    h2 { color:#d4af37; margin:15px 0; }
    input, select { padding:10px; border:none; border-radius:6px; width:100%; margin:5px 0; background:#2c2c2c; color:white; }
    .btn { background:#8e44ad; padding:10px; margin:5px; border-radius:6px; cursor:pointer; border:none; color:white; font-weight:bold; }
    .btn:hover { background:#b8860b; }
    .chart-card { background:#1a1a1a; border-radius:12px; padding:15px; margin:20px auto; box-shadow:0 4px 20px rgba(0,0,0,0.6); max-width:1200px; }
    .chart { width:100%; height:400px; }
    .kpi { background:#1a1a1a; display:inline-block; padding:15px; border-radius:10px; margin:10px; min-width:150px; font-size:14px; }
    .list { background:#1a1a1a; border-radius:8px; padding:10px; margin-top:10px; }
    .list div { padding:6px 0; border-bottom:1px solid #333; }
    .list div:last-child { border:none; }
  </style>
</head>
<body>
<header>ðŸ“Š DashControl Enterprise FINAL</header>
<nav>
  <button onclick="showTab('estoque')">ðŸ“¦ Estoque</button>
  <button onclick="showTab('vendas')">ðŸ›’ Vendas</button>
  <button onclick="showTab('financeiro')">ðŸ’° Financeiro</button>
  <button onclick="showTab('dashboard')">ðŸ“ˆ Dashboard</button>
</nav>

<!-- ðŸ“¦ Estoque -->
<section id="estoque">
  <h2>ðŸ“¦ GestÃ£o de Estoque</h2>
  <input type="text" id="estNome" placeholder="Nome do Produto/ServiÃ§o">
  <input type="number" id="estCompra" placeholder="Valor de Compra (R$)">
  <input type="number" id="estVenda" placeholder="Valor de Venda (R$)">
  <input type="number" id="estQtd" placeholder="Quantidade (vazio = serviÃ§o)">
  <button class="btn" onclick="addEstoque()">âž• Adicionar</button>
  <div class="list" id="listaEstoque"></div>
</section>

<!-- ðŸ›’ Vendas -->
<section id="vendas">
  <h2>ðŸ›’ Registrar Venda</h2>
  <select id="venProduto"></select>
  <input type="number" id="venValor" placeholder="Valor" readonly>
  <select id="venPagamento">
    <option>Pix</option><option>DÃ©bito</option><option>CrÃ©dito</option><option>Dinheiro</option>
  </select>
  <input type="number" id="venRecebido" placeholder="Valor Recebido (se Dinheiro)">
  <input type="date" id="venData">
  <button class="btn" onclick="addVenda()">ðŸ’¾ Registrar Venda</button>
  <div class="list" id="listaVendas"></div>
</section>

<!-- ðŸ’° Financeiro -->
<section id="financeiro">
  <h2>ðŸ’° Controle Financeiro</h2>
  <input type="number" id="caixaInicial" placeholder="Caixa Inicial do Dia">
  <button class="btn" onclick="setCaixa()">ðŸ“Œ Definir Caixa</button>
  <div class="kpi">Entradas: R$ <span id="finEntradas">0</span></div>
  <div class="kpi">SaÃ­das: R$ <span id="finSaidas">0</span></div>
  <div class="kpi">Lucro: R$ <span id="finLucro">0</span></div>
  <div class="kpi">Saldo: R$ <span id="finSaldo">0</span></div>
</section>

<!-- ðŸ“ˆ Dashboard -->
<section id="dashboard">
  <h2>ðŸ“Š Dashboard Premium</h2>
  <div class="kpi">Receita Total: R$ <span id="kpiReceita">0</span></div>
  <div class="kpi">Lucro Total: R$ <span id="kpiLucro">0</span></div>
  <div class="kpi">Ticket MÃ©dio: R$ <span id="kpiTicket">0</span></div>
  <div class="chart-card"><div id="chartVendas" class="chart"></div></div>
  <div class="chart-card"><div id="chartFinanceiro" class="chart"></div></div>
  <div class="chart-card"><div id="chartEstoque" class="chart"></div></div>
  <div class="chart-card"><div id="chartPagamentos" class="chart"></div></div>
  <div class="chart-card"><div id="chartLinha" class="chart"></div></div>
</section>

<script>
let dados = JSON.parse(localStorage.getItem("enterprise")) || {estoque:[], vendas:[], financeiro:{caixa:0, entradas:0, saidas:0, lucro:0, saldo:0}};

// NavegaÃ§Ã£o
function showTab(tab){
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(tab).style.display="block";
  if(tab==="estoque") renderEstoque();
  if(tab==="vendas") renderVendas();
  if(tab==="financeiro") renderFinanceiro();
  if(tab==="dashboard") renderDashboard();
}
function save(){ localStorage.setItem("enterprise",JSON.stringify(dados)); }

// ðŸ“¦ Estoque
function addEstoque(){
  let nome=document.getElementById("estNome").value;
  let compra=parseFloat(document.getElementById("estCompra").value)||0;
  let venda=parseFloat(document.getElementById("estVenda").value)||0;
  let qtd=document.getElementById("estQtd").value===""?null:parseInt(document.getElementById("estQtd").value);
  if(!nome||!venda){alert("Preencha todos os campos obrigatÃ³rios!");return;}
  dados.estoque.push({nome,compra,venda,qtd});
  save(); renderEstoque(); alert("âœ… Produto adicionado!");
}
function renderEstoque(){
  let html=""; dados.estoque.forEach((e,i)=>{html+=`<div>${e.nome} - Compra R$${e.compra} | Venda R$${e.venda} | Qtd: ${e.qtd??'ServiÃ§o'}</div>`;});
  document.getElementById("listaEstoque").innerHTML=html||"<p>Sem itens.</p>";
  let sel=document.getElementById("venProduto"); sel.innerHTML="";
  dados.estoque.forEach((p,i)=>{let opt=document.createElement("option");opt.value=i;opt.textContent=`${p.nome} (R$${p.venda})`;sel.appendChild(opt);});
}

// ðŸ›’ Vendas
function addVenda(){
  let idx=document.getElementById("venProduto").value;
  if(idx===""){alert("Selecione um produto!");return;}
  let prod=dados.estoque[idx];
  let valor=prod.venda;
  let pagamento=document.getElementById("venPagamento").value;
  let recebido=parseFloat(document.getElementById("venRecebido").value)||valor;
  let data=document.getElementById("venData").value||new Date().toISOString().split("T")[0];
  let troco=0;
  if(pagamento==="Dinheiro"&&recebido>valor){troco=recebido-valor; dados.financeiro.saidas+=troco;}
  if(prod.qtd!==null&&prod.qtd>0){prod.qtd--;}
  let lucro=valor-(prod.compra||0);
  dados.vendas.push({produto:prod.nome,valor,pagamento,data,lucro});
  dados.financeiro.entradas+=valor; dados.financeiro.lucro+=lucro;
  dados.financeiro.saldo=(dados.financeiro.caixa||0)+dados.financeiro.entradas-dados.financeiro.saidas;
  save(); renderVendas(); alert("âœ… Venda registrada!");
}
function renderVendas(){
  let html=""; dados.vendas.slice(-5).forEach(v=>{html+=`<div>${v.data} - ${v.produto} - R$${v.valor} (${v.pagamento}) [Lucro R$${v.lucro}]</div>`;});
  document.getElementById("listaVendas").innerHTML=html||"<p>Sem vendas.</p>";
}

// ðŸ’° Financeiro
function setCaixa(){
  dados.financeiro.caixa=parseFloat(document.getElementById("caixaInicial").value)||0;
  dados.financeiro.saldo=dados.financeiro.caixa+dados.financeiro.entradas-dados.financeiro.saidas;
  save(); renderFinanceiro();
}
function renderFinanceiro(){
  document.getElementById("finEntradas").innerText=dados.financeiro.entradas.toFixed(2);
  document.getElementById("finSaidas").innerText=dados.financeiro.saidas.toFixed(2);
  document.getElementById("finLucro").innerText=dados.financeiro.lucro.toFixed(2);
  document.getElementById("finSaldo").innerText=dados.financeiro.saldo.toFixed(2);
}

// ðŸ“Š Dashboard
function renderDashboard(){
  document.getElementById("kpiReceita").innerText=dados.financeiro.entradas.toFixed(2);
  document.getElementById("kpiLucro").innerText=dados.financeiro.lucro.toFixed(2);
  document.getElementById("kpiTicket").innerText=(dados.vendas.length?(dados.financeiro.entradas/dados.vendas.length):0).toFixed(2);

  // Vendas por Produto
  let porProd={}; dados.vendas.forEach(v=>{porProd[v.produto]=(porProd[v.produto]||0)+v.valor;});
  echarts.init(document.getElementById("chartVendas")).setOption({
    title:{text:"ðŸ›’ Vendas por Produto",textStyle:{color:"#d4af37"}},
    xAxis:{type:"category",data:Object.keys(porProd),axisLabel:{color:"#fff"}},
    yAxis:{type:"value",axisLabel:{color:"#fff"}},
    series:[{type:"bar",data:Object.values(porProd),label:{show:true,color:"#fff"}}]
  });

  // Financeiro
  echarts.init(document.getElementById("chartFinanceiro")).setOption({
    title:{text:"ðŸ’° Entradas x SaÃ­das",textStyle:{color:"#d4af37"}},
    xAxis:{type:"category",data:["Entradas","SaÃ­das","Lucro"],axisLabel:{color:"#fff"}},
    yAxis:{type:"value",axisLabel:{color:"#fff"}},
    series:[{type:"bar",data:[dados.financeiro.entradas,dados.financeiro.saidas,dados.financeiro.lucro],label:{show:true,color:"#fff"}}]
  });

  // Estoque
  echarts.init(document.getElementById("chartEstoque")).setOption({
    title:{text:"ðŸ“¦ Estoque",textStyle:{color:"#d4af37"}},
    xAxis:{type:"category",data:dados.estoque.map(p=>p.nome),axisLabel:{color:"#fff"}},
    yAxis:{type:"value",axisLabel:{color:"#fff"}},
    series:[{type:"bar",data:dados.estoque.map(p=>p.qtd??0),label:{show:true,color:"#fff"}}]
  });

  // Pagamentos
  let formas={}; dados.vendas.forEach(v=>{formas[v.pagamento]=(formas[v.pagamento]||0)+v.valor;});
  echarts.init(document.getElementById("chartPagamentos")).setOption({
    title:{text:"ðŸ’³ Formas de Pagamento",textStyle:{color:"#d4af37"}},
    series:[{type:"pie",radius:["40%","70%"],data:Object.entries(formas).map(([k,v])=>({name:k,value:v})),label:{show:true,color:"#fff"}}]
  });

  // Receita no Tempo
  let porData={}; dados.vendas.forEach(v=>{porData[v.data]=(porData[v.data]||0)+v.valor;});
  echarts.init(document.getElementById("chartLinha")).setOption({
    title:{text:"ðŸ“ˆ Receita no Tempo",textStyle:{color:"#d4af37"}},
    xAxis:{type:"category",data:Object.keys(porData),axisLabel:{color:"#fff"}},
    yAxis:{type:"value",axisLabel:{color:"#fff"}},
    series:[{type:"line",data:Object.values(porData),smooth:true,areaStyle:{color:"rgba(212,175,55,0.3)"},label:{show:true,color:"#fff"}}]
  });
}

// InicializaÃ§Ã£o
showTab("estoque");
</script>
</body>
</html>