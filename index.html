<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üçΩÔ∏è Restaurante Control</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { margin:0; font-family:'Poppins',sans-serif; background:#0d0d0d; color:white; }
    header { background:linear-gradient(90deg,#8e44ad,#b8860b); padding:15px; text-align:center; font-size:22px; font-weight:700; }
    nav { display:flex; justify-content:center; flex-wrap:wrap; background:#1e1e1e; }
    nav button { background:#8e44ad; border:none; margin:5px; padding:10px 15px; border-radius:6px; cursor:pointer; color:white; font-weight:600; }
    nav button:hover { background:#b8860b; }
    section { display:none; padding:20px; max-width:1000px; margin:auto; }
    h2 { color:#d4af37; margin-bottom:10px; }
    input, select { width:100%; padding:10px; margin:5px 0; border:none; border-radius:6px; background:#2c2c2c; color:white; }
    .btn { background:#8e44ad; padding:10px; margin:5px 0; border:none; border-radius:6px; cursor:pointer; color:white; font-weight:bold; }
    .btn:hover { background:#b8860b; }
    .list { background:#1a1a1a; border-radius:8px; padding:10px; margin-top:10px; }
    .list div { padding:6px 0; border-bottom:1px solid #333; }
    .chart-card { background:#1a1a1a; border-radius:12px; padding:15px; margin:20px auto; box-shadow:0 4px 15px rgba(0,0,0,0.6); max-width:1200px; }
    .chart { width:100%; height:400px; }
    .kpi { display:inline-block; background:#1a1a1a; padding:10px; margin:5px; border-radius:6px; min-width:150px; text-align:center; }
  </style>
</head>
<body>

<header>üçΩÔ∏è Restaurante Control</header>
<nav>
  <button onclick="showTab('garcom')">üßë Gar√ßom</button>
  <button onclick="showTab('admin')">‚öôÔ∏è Admin</button>
  <button onclick="showTab('dashboard')">üìä Dashboard</button>
</nav>

<!-- üßë Gar√ßom -->
<section id="garcom">
  <h2>üßë Gar√ßom - Abrir Mesa</h2>
  <input type="text" id="garcomNome" placeholder="Nome do Gar√ßom">
  <input type="number" id="mesaNumero" placeholder="N√∫mero da Mesa">
  <select id="pedidoProduto"></select>
  <button class="btn" onclick="addPedido()">‚ûï Adicionar Pedido</button>
  <div class="list" id="listaPedidos"></div>
</section>

<!-- ‚öôÔ∏è Admin -->
<section id="admin">
  <h2>üì¶ Estoque</h2>
  <input type="text" id="estNome" placeholder="Produto">
  <input type="number" id="estPreco" placeholder="Pre√ßo (R$)">
  <input type="number" id="estQtd" placeholder="Quantidade">
  <button class="btn" onclick="addEstoque()">‚ûï Adicionar Produto</button>
  <div class="list" id="listaEstoque"></div>

  <h2>üí∞ Caixa</h2>
  <input type="number" id="caixaInicial" placeholder="Caixa Inicial (R$)">
  <button class="btn" onclick="definirCaixa()">üìå Definir Caixa</button>
  <div class="kpi">Entradas: R$ <span id="finEntradas">0</span></div>
  <div class="kpi">Sa√≠das: R$ <span id="finSaidas">0</span></div>
  <div class="kpi">Saldo: R$ <span id="finSaldo">0</span></div>

  <h2>üßæ Mesas Abertas</h2>
  <div class="list" id="listaMesas"></div>
</section>

<!-- üìä Dashboard -->
<section id="dashboard">
  <h2>üìä Dashboard</h2>
  <div class="kpi">Receita Total: R$ <span id="kpiReceita">0</span></div>
  <div class="kpi">Ticket M√©dio: R$ <span id="kpiTicket">0</span></div>
  <div class="chart-card"><div id="chartProdutos" class="chart"></div></div>
  <div class="chart-card"><div id="chartGarcons" class="chart"></div></div>
  <div class="chart-card"><div id="chartPagamentos" class="chart"></div></div>
</section>

<script>
let db = JSON.parse(localStorage.getItem("restaurante")) || {estoque:[], pedidos:[], financeiro:{caixa:0, entradas:0, saidas:0, saldo:0}};

// Navega√ß√£o
function showTab(tab){
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(tab).style.display="block";
  if(tab==="garcom") renderProdutos();
  if(tab==="admin"){ renderEstoque(); renderMesas(); renderFinanceiro(); }
  if(tab==="dashboard") renderDashboard();
}
function save(){ localStorage.setItem("restaurante",JSON.stringify(db)); }

// üßë Gar√ßom
function renderProdutos(){
  let sel=document.getElementById("pedidoProduto"); sel.innerHTML="";
  db.estoque.forEach((p,i)=>{ if(p.qtd>0){ let opt=document.createElement("option"); opt.value=i; opt.textContent=`${p.nome} (R$${p.preco})`; sel.appendChild(opt); } });
}
function addPedido(){
  let garcom=document.getElementById("garcomNome").value;
  let mesa=document.getElementById("mesaNumero").value;
  let idx=document.getElementById("pedidoProduto").value;
  if(!garcom||!mesa||idx===""){alert("Preencha todos os campos!");return;}
  let prod=db.estoque[idx]; if(prod.qtd<=0){alert("Produto sem estoque!");return;}
  prod.qtd--;
  db.pedidos.push({garcom,mesa,produto:prod.nome,preco:prod.preco,data:new Date().toISOString().split("T")[0]});
  db.financeiro.entradas+=prod.preco; db.financeiro.saldo=db.financeiro.caixa+db.financeiro.entradas-db.financeiro.saidas;
  save(); renderPedidos(mesa); renderMesas(); renderFinanceiro(); alert("‚úÖ Pedido adicionado!");
}
function renderPedidos(mesa){
  let html=""; db.pedidos.filter(p=>p.mesa==mesa).forEach(p=>{html+=`<div>${p.produto} - R$${p.preco} (${p.garcom})</div>`;});
  document.getElementById("listaPedidos").innerHTML=html||"<p>Sem pedidos.</p>";
}

// ‚öôÔ∏è Admin
function addEstoque(){
  let nome=document.getElementById("estNome").value;
  let preco=parseFloat(document.getElementById("estPreco").value);
  let qtd=parseInt(document.getElementById("estQtd").value);
  if(!nome||!preco||!qtd){alert("Preencha todos os campos!");return;}
  db.estoque.push({nome,preco,qtd}); save(); renderEstoque(); alert("‚úÖ Produto adicionado!");
}
function renderEstoque(){
  let html=""; db.estoque.forEach(e=>{html+=`<div>${e.nome} - R$${e.preco} | Qtd: ${e.qtd}</div>`;});
  document.getElementById("listaEstoque").innerHTML=html||"<p>Sem estoque.</p>";
}
function definirCaixa(){
  db.financeiro.caixa=parseFloat(document.getElementById("caixaInicial").value)||0;
  db.financeiro.saldo=db.financeiro.caixa+db.financeiro.entradas-db.financeiro.saidas;
  save(); renderFinanceiro(); alert("üíµ Caixa inicial definido!");
}
function renderFinanceiro(){
  document.getElementById("finEntradas").innerText=db.financeiro.entradas;
  document.getElementById("finSaidas").innerText=db.financeiro.saidas;
  document.getElementById("finSaldo").innerText=db.financeiro.saldo;
}
function renderMesas(){
  let mesas=[...new Set(db.pedidos.map(p=>p.mesa))];
  let html=""; mesas.forEach(m=>{
    let total=db.pedidos.filter(p=>p.mesa==m).reduce((s,p)=>s+p.preco,0);
    html+=`<div>Mesa ${m} - Total R$${total} <button onclick="fecharMesa('${m}')">Encerrar</button></div>`;
  });
  document.getElementById("listaMesas").innerHTML=html||"<p>Nenhuma mesa aberta.</p>";
}
function fecharMesa(mesa){
  if(confirm("Encerrar mesa "+mesa+"?")){ db.pedidos=db.pedidos.filter(p=>p.mesa!=mesa); save(); renderMesas(); renderPedidos(mesa); renderDashboard(); }
}

// üìä Dashboard
function renderDashboard(){
  document.getElementById("kpiReceita").innerText=db.financeiro.entradas;
  document.getElementById("kpiTicket").innerText=(db.financeiro.entradas/(db.pedidos.length||1)).toFixed(2);

  // Vendas por Produto
  let porProd={}; db.pedidos.forEach(p=>{porProd[p.produto]=(porProd[p.produto]||0)+p.preco;});
  echarts.init(document.getElementById("chartProdutos")).setOption({
    title:{text:"üõí Vendas por Produto",textStyle:{color:"#d4af37"}},
    xAxis:{type:"category",data:Object.keys(porProd),axisLabel:{color:"#fff"}},
    yAxis:{type:"value",axisLabel:{color:"#fff"}},
    series:[{type:"bar",data:Object.values(porProd),label:{show:true,color:"#fff"}}]
  });

  // Vendas por Gar√ßom
  let porGar={}; db.pedidos.forEach(p=>{porGar[p.garcom]=(porGar[p.garcom]||0)+p.preco;});
  echarts.init(document.getElementById("chartGarcons")).setOption({
    title:{text:"üßë Vendas por Gar√ßom",textStyle:{color:"#d4af37"}},
    xAxis:{type:"category",data:Object.keys(porGar),axisLabel:{color:"#fff"}},
    yAxis:{type:"value",axisLabel:{color:"#fff"}},
    series:[{type:"bar",data:Object.values(porGar),label:{show:true,color:"#fff"}}]
  });

  // Formas de Pagamento (simulado como tudo Pix por enquanto)
  let formas={Pix:db.financeiro.entradas};
  echarts.init(document.getElementById("chartPagamentos")).setOption({
    title:{text:"üí≥ Pagamentos",textStyle:{color:"#d4af37"}},
    series:[{type:"pie",radius:["40%","70%"],data:Object.entries(formas).map(([k,v])=>({name:k,value:v})),label:{show:true,color:"#fff"}}]
  });
}

// Inicializa na aba Gar√ßom
showTab("garcom");
</script>
</body>
</html>